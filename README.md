# 記織 -Kiori-
Discord上で !ask コマンドを使って、ローカルのLM Studio上に載っているLLM（例：Mistral, LLaMAなど）と会話するためのBOTです。

必要なもの
１、　そこそこのスペックがあるPC
２、　ぱいそん(3.8以上推奨)
３，　Discordのあかうんと(BOTトークン)
４、　やる気とちょっとの知識

使い方
【LM Studio 側の設定】
    LM Studio を起動
    使用したいモデルをロード（例：Mistral 7B）
    設定で「OpenAI API互換サーバー」を有効にする
    起動後、以下のようなエンドポイントが使えるはず：http://localhost:1234/v1/chat
１，必要なライブラリを入れておいてね
　　pip install discord.py requests
２，ダウンロードしたbot.pyを開いてね

ディレクトリ構成（例）
kiori/
├── discord_lm_bot.py
└── chat_histories/
    └── 123456789012345678.json  ← 各ユーザーの履歴


使い方（コマンド一覧）
 1. 会話する !ask
!ask <質問内容>
    LLMに質問し、返答を表示します
    過去のやり取りも含めた履歴を元に応答
    例：!ask Pythonでfor文ってどう書くの？

2. 履歴リセット（管理者のみ） !reset_convo

!reset_convo
    ユーザー単位の履歴ファイルを削除します
    管理者のみ実行可能（設定済みのユーザーIDで制御）

3. 現在の履歴数確認 !status
!status
    現在の会話履歴に何件メッセージがあるかを表示

履歴保存の仕様
| 項目      | 内容                                     |
| ------- | -------------------------------------- |
| 単位      | ユーザーごとに個別保存（ユーザーID別）                   |
| 保存形式    | JSONファイル（`chat_histories/ユーザーID.json`） |
| 保持件数上限  | 最大20件（超えると古いものから削除）                    |
| 保存タイミング | 毎回 `!ask` 使用後に自動保存                     |
| 再起動対応   | 永続保存されるので、BOT再起動後も継続可能                 |

管理者制御の仕様
| 項目        | 内容                                       |
| --------- | ---------------------------------------- |
| 方法        | ユーザーIDによるホワイトリスト                         |
| 登録場所      | `ADMIN_USER_IDS = [1234567890, ...]` に記載 |
| 管理者限定コマンド | `!reset_convo`（履歴リセット）など                 |

LM　Studioとの連携
| 項目      | 内容                                       |
| ------- | ---------------------------------------- |
| 必須設定    | LM Studio の OpenAI API モード ON            |
| エンドポイント | `http://localhost:1234/v1/chat`（カスタマイズ可） |
| リクエスト形式 | OpenAI Chat API互換の JSON形式                |
| モデル指定   | 任意（例：`local-model` など）※省略可               |
